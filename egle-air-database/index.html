<!DOCTYPE html>
<html>
  <head>
	<!-- Google tag (gtag.js) -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-8VGH3JMVFG"></script>
	<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());

	gtag('config', 'G-8VGH3JMVFG');
	</script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
	<meta property="og:title" content='Michigan EGLE Air Quality Document Database'>
	<meta property="og:description" content="A continuously updating, searchable dataset of Michigan's Air Quality Division documents">
	<meta property="og:type" content="article">
	<meta property="og:image" content="https://github.com/srjouppi/srjouppi.github.io/blob/main/images/michigan-egle-air-database.png?raw=true">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:creator" content="@shelbyjouppi">     
    <link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="pointsunknown-style.css">
	<link rel="stylesheet" href="article-style.css">
    <title>Michigan EGLE Air Quality Document Database</title>
    <style>
      .bold-yellow {
          font-weight: bold;
          color:#daaa27;
      }
      .bold-blue {
          font-weight: bold;
          color:#3d6de7;
      }
      .bold-red {
          font-weight: bold;
          color:#db5540;
      }
	  a.bold-red {
          font-weight: bold;
          color:#db5540;
      }
	  a.bold-yellow {
          font-weight: bold;
          color:#eaab3f;
		  font-family: 'Roboto Mono', monospace;
    	  font-weight: 400;
      }
	  a.bold-yellow:hover {
          font-weight: bold;
          color:#f7bf5f;
		  background:white;
		  font-family: 'Roboto Mono', monospace;
    	  font-weight: 400;
      }
	  a.bold-red:hover {
          font-weight: bold;
          background:#db5540;
		  color:white;
		  
      }
      a.bold-blue {
          font-weight: bold;
          color:#3d6de7;
		  font-family: 'Roboto Mono', monospace;
    	  font-weight: 400;
      }
	  a.bold-blue:hover {
          font-weight: bold;
          color:#688ce7;
		  background:white;
		  font-family: 'Roboto Mono', monospace;
    	  font-weight: 400;
      }
	  .chart-container{
		max-width:1200px;
	  }
	  ul {
		line-height: 1.7em;
	  }
    </style>
  </head>

 <body>

<div class="menu">
		<a href="https://srjouppi.github.io">Shelby Jouppi</a>
</div>    
<div class="header-box">
    <div class="text-container">
		<span class="dateline">Oct. 3, 2022</span>
		<br/>
        <h1>A searchable dataset of Michigan air polluter documents</h1>
        <h2>That updates daily with Github Actions</h2>
		<span class="author"><a href="https://srjouppi.github.io/">by Shelby Jouppi</a></span>
	</div>
    </div>
<div class="text-container">
	<p> Michigan's Department of Environment, Great Lakes and Energy (EGLE) monitors and inspects thousands of sources of 
		air pollution throughout the state. The department publishes PDF files of inspection reports, violation notices, 
        emissions test results and more on <a href="https://www.egle.state.mi.us/aps/downloads/srn/" target="_blank">its database,</a>
	    however the website is not particularly user-friendly.</p>

	<p> EGLE representatives told me they are in the process of creating a front-end interface
		for this database, but in the meantime I created <a href="https://github.com/srjouppi/michigan-egle-database-auto-scraper" target="_blank">a script</a> 
		to parse the documents by date and type, connect them to identifying about the facilities, 
		and daily look for updates to the database.</p>
</div>

<div class="chart-container">
	<img src="https://github.com/srjouppi/srjouppi.github.io/blob/main/images/egle-database-before-after.png?raw=true"/>
</div>
<div class="text-container">
	<h4>&#10024 Products</h4>
	<hr/>
	<h3>1. Google Sheet - Full history</h3>
	<p>&#128279; <a class="bold-blue" target="_blank" href="https://tinyurl.com/egle-air-documents">tinyurl.com/egle-air-documents</a> 

	<p>Bookmark the above URL for a google sheet that will update daily, and make a copy when you want to work with the data yourself.</p>  

	<h3>2. Google Sheet - Past 90 days</h3>
	<p>&#128279; <a class="bold-yellow" href="https://tinyurl.com/egle-air-documents-90">tinyurl.com/egle-air-documents-90</a></p> 
	<p>If you need something a little more lightweight, you can just keep track of activity from the past 90 days.</p> 

	<h3>3. CSVs of both datasets</h3>
	<p>These are available as .csv files <a href="https://github.com/srjouppi/michigan-egle-database-auto-scraper/tree/main/output">hosted on Github</a> 
	   that you can work with via URL or download.</p>

	<h3>4. Free data assistance!</h3>
	<p>I'm a baby data journalist and I would love to be of service if you run into any issues
		or just have general questions about how to use or query the data.</p>
	<p>Feel free to reach out to me at shelbyjouppi (at) gmail.com or create an appointment in <a href="https://calendly.com/sjouppi" target="_blank">my calendar.</a></p>

	<p> If you notice any errors or have requests for the dataset, reach out via email or
		comment on the <a href="https://github.com/srjouppi/michigan-egle-database-auto-scraper" target="_blank">Github repo.</a></p>
	<p><a href="#docs" class="bold-blue">Read the documentation</a></p>
    <br/>
		<p><h4>Browse activity from the past 90 days</h4></p>
		<hr/>
	</div>
	
	<div class="chart-container">
		<iframe style="border-width:1px;border-radius:5px;" width="100%" height="500px" src="https://docs.google.com/spreadsheets/d/e/2PACX-1vRvGwUqvd8eHjtOSRSzBunrlHhrvAPr4xXiVbN1exaUoUtpLYBNVnfQLrggTTO-FnE9_7V6DTO1TmTD/pubhtml?widget=true&amp;headers=false"></iframe></div>
	<div class="text-container">
	<a name="docs"></a>
	<h4>Documentation & Methodology</h4>
	<hr/>
	<h3>Important caveats to start</h3>
	<p> The dataset was created by scraping the <a href="https://www.egle.state.mi.us/aps/downloads/srn/">Air Quality Division database.</a> 
		<span class = "bold-blue"><i></i>Please note that my scraper only looks for sources that are in a directory provided to me by EGLE in May 2022.</i></span> There may be
		new sources that have cropped up since then, changed their names, or others that have gone out of service. I am in the process of requesting 
		an up-to-date directory. In the mean time you can check the <a href="https://www.egle.state.mi.us/aps/downloads/SRN/Sources_By_ZIP.pdf" target="_blank">master list</a> 
		they publish.</p>

	<p> EGLE has also said that their online database is not necessarily comprehensive. There may be missing documents or other types of reports
		not uploaded for certain reasons. For any questions about the specific sourcesor documents in this dataset, contact EGLE's public information office.</p>

	<h3>Columns in the dataset:</h3>
	
	<h5>DOCUMENT INFO:</h5>
		<ul>
			<li><b>date:</b> Date document issued according to filename</li>
			<li><b>facility_name:</b> Name of company or facility</li>
			<li><b>doc_type:</b> Document type code (ie "VN")</li>
			<li><b>type_name:</b> Name of document type (ie "Violation Notice"). <a href="#key">Read about where these came from</a></li>
			<li><b>doc_url:</b> Link to the document hosted on the EGLE database</li>
		</ul>
	
	<h5>SOURCE INFO:</h5>
		<ul>
			<li><b>srn:</b> EGLE-issued identification number (can be cross referenced with EPA databases)</li>
			<li><b>epa_class:</b> EPA classification of the source (ie "Major")</li>
			<li><b>district_name:</b> EGLE district where facility is located</li>
			<li><b>staff:</b> EGLE staff member assigned to facility</li>
		</ul>
	
	<h5>LOCATION INFO:</h5>
	<i>Use with caution. I have noticed inconsistencies. Sometimes address and zip code are related to the main facility, and not necessarily a specific plant.</i>

		<ul>
			<li><b>address</b></li>
			<li><b>city</b></li>
			<li><b>zip</b></li>
			<li><b>county</b></li>
		</ul>
		
		<h3>Some definitions</h3>
		<p>To help get you started, here are some definitions of certain columns that I obtained during my reporting on this subject.</p>
		<h5>COMMON DOCUMENT TYPES</h5>
		<ul>
			<li><b>Staff Activity Report:</b> Reports filed by EGLE staff when they visit or inspect a facility.</li>
			<li><b>Violation Notice:</b> Noticies sent to facilities when they violate their permits. These violations could be polluting too much,
			failing to keep records or report emissions, in response to public complaints, or a number of other reasons.</li>
			<li><b>Response to Violation Notice:</b> A company's mandatory response to a state-issued violation notice.</li>
			<li><b>Full Compliance Evaluation:</b> Comprehensive inspections that the EPA requires at a variety of intervals depending on the source's class. Major sources require FCEs every two years, synthetic minors every five years, and megasites every three years. EGLE staff inspects the facility, equipment, emissions records and more.</li>
			<li><b>Test:</b> Reports detailing the results of tests on equipment.</li>
			<li><b>Administrative Consent Order:</b> A bi-lateral legal agreement between a company and the government.</li>
			<li><b>Enforcement Notice:</b> The beginning of the state's escalated enforcement action against a company currently in violation of their permit.</li>
			<li><b>Stipulation:</b> A fine issued to a company for a violation.</li>
		</ul>
		<h5>EPA CLASS</h5>
		<ul>
			<li><b>Major:</b> A Title V Major source of air pollution. These facilities pollute large quantities of hazardous air pollutants<a href="https://www.epa.gov/title-v-operating-permits/who-has-obtain-title-v-permit" target="_blank">Read about these permits.</a></li>
			<li><b>SM Opt Out:</b> A "Synthetic Minor" or "Opt Out" source of air pollution. These facilities have the capacity to pollute at or above the major source threshold, but accept permit restrictions to stay below the threshold.</li>
			<li><b>Minor:</b> A True Minor source of air pollution. These facilities thave the capacity to pollute below major source thresholds. Read more about <a href="https://www.epa.gov/tribal-air/true-minor-source-and-synthetic-minor-source-permits" target="_blank">the distinction</a> between true minor and synthetic minor sources.</li>
			<li><b>Megasite:</b> A large operation with several major sources of air pollution.</li>
		</ul>

		<a name="key"></a>
		<h3>Document type code key</h3>
		<p>I created <a href="https://github.com/srjouppi/michigan-egle-database-auto-scraper/blob/main/EGLE-AQD-document-code-key.xlsx", target="_blank">the key</a> manually in September 2022 by reviewing examples of each document type and using the language in the document to come up with the key. Please report errors to shelbyjouppi (at) gmail.com. Michigan EGLE should be consulted with any questions about specific documents or naming conventions.</p>
		<p>Caveat: When a digit is included in the code (ie VN2), it is not always used in a uniform way. For simplicity's sake, I titled these 1st, 2nd, 3rd, etc. However these document should be reviewed in context with scrutiny and not necessarily used in aggregates.</p>

		<h3>Methodology</h3>
		<p>Using Beautiful Soup, I scraped over 18,000 documents for these sources of air pollution. With Regex, I extracted the urls of the documents as well as data from the documents' names, which were all structured predicably as such:</p>
		<h5><span class="bold-blue">{SOURCE ID}</span>_<span class="bold-yellow">{TYPE OF DOCUMENT}</span>_<span class="bold-red">{DATE ISSUED}</span>.pdf</h5>
		<p>I joined the scraped data with identifing information (name, location, source type) from the master list. I also created a document code key (EGLE-AQD-document-code-key.xlsx) manually so users can easily see what kind of document they are looking at.</p>
		<p>The autoscraper uses Github Actions, Beautiful Soup and Regex search the database for directories that have new updates, go into those folders and search for URLs that are not already in the dataset. It also uses the Python library pygsheets to
	       publish the updated Google Sheets.</p>
		<p><a class="bold-blue" href="https://github.com/srjouppi/michigan-egle-database-auto-scraper" target="_blank">View the code</a></p>
		<h3>Gratitude</h3>
		<p>Many thanks to my generous professors <a href="http://floatingmedia.com/" target="_blank">Jon Thirkhield</a> and <a href="https://jonathansoma.com/" target="_blank">Jonathan Soma</a> who shared their code and helped me troubleshoot along the way.</p>
		<p>Happy searching! And don't hesitate to reach out.</p>
		<br/>
		<br/>
		<br/>
	</p>
	</div>
	<div class="bottom-nav">
		<div class="back-article"><a href="/nyc-child-psychologists/"><-- Visualizing the child psychologist shortage</a></div><div class="forward-article"><a href="/michigan-great-lakes-usage/">Analyzing changes in Great Lakes water consumption --></a></div>
	</div>

<div class="footer">
	<a href="https://srjouppi.github.io/"><-- Back to portfolio</a>
</div>
  </body>
</html>
